{% extends "fuxi_framework/framework_base.html" %}


{% block content %}

    <link rel="stylesheet" type="text/css" href="http://cdn.datatables.net/plug-ins/28e7751dbec/integration/bootstrap/3/dataTables.bootstrap.css" /> 
    <script src="http://cdn.gbtags.com/datatables/1.10.5/js/jquery.js"></script> 
    <script src="http://cdn.gbtags.com/datatables/1.10.5/js/jquery.dataTables.min.js"></script> 
    <script type="text/javascript" language="javascript" src="http://cdn.datatables.net/plug-ins/28e7751dbec/integration/bootstrap/3/dataTables.bootstrap.js"></script> 

    <div>
        <p>  
        <p>  
        <p>  
        <p>  
        <p>
        <p><strong>TASK列表</strong></p>
        <p>  
        <p>
        <p>  
        <p>
    </div>

    <div id="container"> 
        <table id="example" class="table table-striped table-bordered dataTable" role="grid" aria-describedby="example_info"> 
            <thead> 
                <tr> 
                    <th></th> 
                    <th>task_id</th> 
                    <th>优先级</th> 
                    <th>实体类型</th> 
                    <th>实体名</th> 
                    <th>阈值</th> 
                    <th>进度</th> 
                    <th>状态</th> 
                    <th>创建时间</th> 
                    <th>启动时间</th> 
                    <th>完成时间</th> 
                    <th>超时</th> 
                </tr> 
            </thead> 
            <tbody></tbody> 
            <tfoot> </tfoot> 
            <!-- tbody是必须的 --> 
        </table> 
    </div>

    <script>
        var t = $('#example').DataTable({
        ajax: {
            url: "/framework/v1/tasks/?format=json&job_id={{job_id}}"
        },
        pageLength: 10,
        columns: [{
            'data': null //此列不绑定数据源，用来显示序号
        },
        {
            'data': 'task_id'
        },
        {
            'data': 'task_priority'
        },
        {
            'data': 'entity_type'
        },
        {
            'data': 'entity_name'
        },
        {
            'data': 'threshold'
        },
        {
            'data': 'progress'
        },
        {
            'data': 'state'
        },
        {
            'data': 'create_time'
        },
        {
            'data': 'start_time'
        },
        {
            'data': 'finish_time'
        },
        {
            'data': 'timeout'
        }],
        'columnDefs': [{
            // 'visible': false,
            //'targets': 0
        },
        {
            "render": function(data, type, row, meta) {
                //渲染 把数据源中的标题和url组成超链接
                //return '<a href="/framework/v1/jobs/?format=json" target="_blank">' + data + '</a>';
                return '<a href="/framework/actions/?task_id=' + data + '" target="_blank">' + data + '</a>';
            },
            //指定是第三列
            "targets": 1
        }
        ]
        });

    //前台添加序号
    t.on('order.dt search.dt',
        function() {
            t.column(0, {
                "search": 'applied',
                "order": 'applied'
            }).nodes().each(function(cell, i) {
                cell.innerHTML = i + 1;
            });
    }).draw();

    </script>


{% endblock %}
